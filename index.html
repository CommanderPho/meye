<!DOCTYPE html>
<html lang="en">

<head>
    <title>Pupillometry</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Import the webpage's stylesheet -->
    <link rel="stylesheet" href="css/main.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>

<body>
    <h1>Pupillometry</h1>

    <section id="input-params">
        <fieldset id="capture-params">
            <legend>Input</legend>
            <label for="file-input">Video File:</label><input type="file" accept="video/*" id="file-input">
            <label for="webcamButton">or: </label><input type="button" id="webcamButton" value="Enable Webcam">
            <span id="input-error"></span>
        </fieldset>
        <fieldset id="model-params">
            <legend>Model</legend>
            <select id="modelSelector">
                <option>meye-segmentation_i128_s4_c1_f16_g1_a-relu-no-subj</option>
                <option>meye-segmentation_i128_s4_c1_f16_g1_a-relu</option>
            </select>
        </fieldset>
    </section>

    <section>
        <aside id="pre-post-params">
            <fieldset id="roi-params">
                <legend>ROI</legend>
                <label for="roi-left" title="X-coordinate of top left corner of the ROI">X:<input type="number" min="0" id="roi-left"></label>
                <label for="roi-top" title="Y-coordinate of top left corner of the ROI">Y:<input type="number" min="0" id="roi-top"></label>
                <label for="roi-size" title="Length of the side of the squared ROI">Size:<input type="number" min="0" id="roi-size"></label>
            </fieldset>

            <fieldset id="filter-params">
                <legend>Prediction</legend>
                <label for="control-period" title="Time to wait between predictions (0 = fastest possible)">Period (ms): <input type="number" min="0" value=0 id="control-period"></label>
                <label for="control-thr-preview" title="Pupil probability map threshold">Threshold: <input type="number" min="0" max="1" step="0.01" value="0.50" id="control-thr-preview"></label>
                <label><input type="range" min="0" max="100" id="control-thr"></label>
                <label for="control-morphology">Morphology: <input type="checkbox" id="control-morphology" checked></label>
            </fieldset>

            <fieldset>
                <legend>Triggers</legend>
                <input type="button" value="Trigger 1 (T)" id="control-trigger-1" accesskey="t" data-trigger-id="0">
                <input type="button" value="Trigger 2 (Y)" id="control-trigger-2" accesskey="y" data-trigger-id="1">
            </fieldset>
        </aside>
        <fieldset id="video-params">
            <legend>
                Preview
                <label><meter id="fps-meter" min=0 value=24 max=30></meter> FPS: <span id="fps-preview"></span></label>
            </legend>
            <div id="preview">
                <div draggable="true" id="roi">
                    <canvas id="output"></canvas>
                </div>
                <div id="pupil-x"><span>x=13.0</span></div>
                <div id="pupil-y"><span>y=24.1</span></div>
                <video id="webcam" controls="1" src="2p_gNex6.mp4"></video>
            </div>
        </fieldset>
    </section>

    <section id="outputs">
        <fieldset id="out-graph" class="out">
            <legend>
                <!-- thanks FF.. -->
                <div class="flex-legend">
                    Plot
                    <span>
                        <label><input type="checkbox" checked="true" id="control-plot-autoupdate"> Auto-Update</label>
                        <label><input type="checkbox" id="control-plot-window-enable" checked> Show only <input type="number" min="1" value=100 id="control-plot-window"> last samples</label>
                        <label><input type="button" id="control-plot-update" value="Update Plot"></label>
                    </span>
                </div>
            </legend>
            <div id="chart-container"></div>
        </fieldset>

        <fieldset id="out-data" class="out">
            <legend>
                <div class="flex-legend">
                    Data
                    <output id="sample-count">0</output>
                    <span>
                        <label><input type="checkbox" checked="true" id="control-table-autoupdate"> Auto-Update</label>
                        <input type="button" value="Update Table" id="control-table-update">
                        <input type="button" value="Clear Data" id="control-clear" accesskey="c">
                        <input type="button" value="Export CSV" id="control-export-csv" accesskey="e">
                    </span>
                </div>
            </legend>
            <div id="sticky-header">
                <table id="trace">
                    <thead>
                        <th>timestamp</th>
                        <th>timecode</th>
                        <th>pupil-area</th>
                        <th>blink</th>
                        <th>px</th>
                        <th>py</th>
                        <th>t1</th>
                        <th>t2</th>
                    </thead>
                    <tbody id="trace-data"></tbody>
                </table>
            </div>
        </fieldset>

    </section>
    <div id="loading"><span>Loading model...</span></div>
    <!-- Import TensorFlow.js library -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js" type="text/javascript"></script>
    <!-- Import the page's JavaScript to do some stuff -->
    <script src="js/main.js" defer></script>
</body>

</html>
